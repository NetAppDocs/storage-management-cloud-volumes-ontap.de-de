---
sidebar: sidebar 
permalink: task-managing-svms-aws.html 
keywords: storage virtual machine, vserver, svm, storage vm, supported number, number supported 
summary: Eine Storage-VM ist eine virtuelle Maschine, die innerhalb von ONTAP ausgeführt wird und Ihren Clients Speicher- und Datendienste bereitstellt.  Sie kennen dies möglicherweise als SVM oder VServer.  Cloud Volumes ONTAP ist standardmäßig mit einer Speicher-VM konfiguriert, einige Konfigurationen unterstützen jedoch zusätzliche Speicher-VMs. 
---
= Verwalten Sie datenbereitstellende Speicher-VMs für Cloud Volumes ONTAP in AWS
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
Eine Storage-VM ist eine virtuelle Maschine, die innerhalb von ONTAP ausgeführt wird und Ihren Clients Speicher- und Datendienste bereitstellt.  Sie kennen dies möglicherweise als _SVM_ oder _vServer_.  Cloud Volumes ONTAP ist standardmäßig mit einer Speicher-VM konfiguriert, einige Konfigurationen unterstützen jedoch zusätzliche Speicher-VMs.

Um zusätzliche datenbereitstellende Speicher-VMs zu erstellen, müssen Sie IP-Adressen in AWS zuweisen und dann ONTAP -Befehle basierend auf Ihrer Cloud Volumes ONTAP Konfiguration ausführen.



== Unterstützte Anzahl von Speicher-VMs

Ab der Version 9.7 werden mehrere Speicher-VMs mit bestimmten Cloud Volumes ONTAP -Konfigurationen unterstützt.  Gehen Sie zum https://docs.netapp.com/us-en/cloud-volumes-ontap-relnotes/index.html["Versionshinweise zu Cloud Volumes ONTAP"^] um die unterstützte Anzahl von Speicher-VMs für Ihre Version von Cloud Volumes ONTAP zu überprüfen.

Alle anderen Cloud Volumes ONTAP -Konfigurationen unterstützen eine Datenspeicher-VM und eine Zielspeicher-VM, die für die Notfallwiederherstellung verwendet wird.  Sie können die Zielspeicher-VM für den Datenzugriff aktivieren, wenn es auf der Quellspeicher-VM zu einem Ausfall kommt.



== Überprüfen der Grenzwerte für Ihre Konfiguration

Jede EC2-Instance unterstützt eine maximale Anzahl privater IPv4-Adressen pro Netzwerkschnittstelle.  Sie müssen das Limit überprüfen, bevor Sie in AWS IP-Adressen für die neue Speicher-VM zuweisen.

.Schritte
. Gehen Sie zum https://docs.netapp.com/us-en/cloud-volumes-ontap-relnotes/reference-limits-aws.html["Abschnitt „Speicherlimits“ in den Versionshinweisen zu Cloud Volumes ONTAP"^] .
. Ermitteln Sie die maximale Anzahl von IP-Adressen pro Schnittstelle für Ihren Instanztyp.
. Notieren Sie sich diese Nummer, da Sie sie im nächsten Abschnitt benötigen, wenn Sie IP-Adressen in AWS zuweisen.




== IP-Adressen in AWS zuweisen

Bevor Sie LIFs für die neue Speicher-VM erstellen, müssen dem Port e0a in AWS private IPv4-Adressen zugewiesen werden.

Beachten Sie, dass ein optionales Verwaltungs-LIF für eine Speicher-VM eine private IP-Adresse auf einem Einzelknotensystem und auf einem HA-Paar in einer einzelnen AZ erfordert.  Dieses Verwaltungs-LIF bietet eine Verbindung zu Verwaltungstools wie SnapCenter.

.Schritte
. Melden Sie sich bei AWS an und öffnen Sie den EC2-Dienst.
. Wählen Sie die Cloud Volumes ONTAP -Instanz aus und klicken Sie auf *Netzwerk*.
+
Wenn Sie eine Speicher-VM auf einem HA-Paar erstellen, wählen Sie Knoten 1 aus.

. Scrollen Sie nach unten zu *Netzwerkschnittstellen* und klicken Sie auf die *Schnittstellen-ID* für Port e0a.
+
image:screenshot_aws_e0a.gif["Ein Screenshot der AWS-Konsole, der Port e0a auf einer Netzwerkschnittstelle zeigt."]

. Wählen Sie die Netzwerkschnittstelle aus und klicken Sie auf *Aktionen > IP-Adressen verwalten*.
. Erweitern Sie die Liste der IP-Adressen für e0a.
. Überprüfen Sie die IP-Adressen:
+
.. Zählen Sie die Anzahl der zugewiesenen IP-Adressen, um zu bestätigen, dass der Port Platz für zusätzliche IPs hat.
+
Sie sollten die maximale Anzahl unterstützter IP-Adressen pro Schnittstelle im vorherigen Abschnitt dieser Seite ermittelt haben.

.. Optional: Gehen Sie zur ONTAP CLI für Cloud Volumes ONTAP und führen Sie *network interface show* aus, um zu bestätigen, dass jede dieser IP-Adressen verwendet wird.
+
Wenn eine IP-Adresse nicht verwendet wird, können Sie sie mit der neuen Speicher-VM verwenden.



. Klicken Sie in der AWS-Konsole auf *Neue IP-Adresse zuweisen*, um zusätzliche IP-Adressen basierend auf der Anzahl zuzuweisen, die Sie für die neue Speicher-VM benötigen.
+
** Einzelknotensystem: Eine ungenutzte sekundäre private IP ist erforderlich.
+
Eine optionale sekundäre private IP ist erforderlich, wenn Sie ein Verwaltungs-LIF auf der Speicher-VM erstellen möchten.

** HA-Paar in einer einzelnen AZ: Auf Knoten 1 ist eine ungenutzte sekundäre private IP erforderlich.
+
Eine optionale sekundäre private IP ist erforderlich, wenn Sie ein Verwaltungs-LIF auf der Speicher-VM erstellen möchten.

** HA-Paar in mehreren AZs: Auf jedem Knoten ist eine ungenutzte sekundäre private IP erforderlich.


. Wenn Sie die IP-Adresse auf einem HA-Paar in einer einzelnen AZ zuweisen, aktivieren Sie *Neuzuweisung sekundärer privater IPv4-Adressen zulassen*.
. Klicken Sie auf *Speichern*.
. Wenn Sie ein HA-Paar in mehreren AZs haben, müssen Sie diese Schritte für Knoten 2 wiederholen.




== Erstellen Sie eine Speicher-VM auf einem Einzelknotensystem

Mit diesen Schritten wird eine neue Speicher-VM auf einem Einzelknotensystem erstellt.  Zum Erstellen eines NAS-LIF ist eine private IP-Adresse erforderlich, und wenn Sie ein Verwaltungs-LIF erstellen möchten, ist eine weitere optionale private IP-Adresse erforderlich.

.Schritte
. Erstellen Sie die Speicher-VM und eine Route zur Speicher-VM.
+
[source, cli]
----
vserver create -rootvolume-security-style unix -rootvolume root_svm_2 -snapshot-policy default -vserver svm_2 -aggregate aggr1
----
+
[source, cli]
----
network route create -destination 0.0.0.0/0 -vserver svm_2 -gateway subnet_gateway
----
. Erstellen Sie ein NAS-LIF.
+
[source, cli]
----
network interface create -auto-revert true -vserver svm_2 -service-policy default-data-files -home-port e0a -address private_ip_x -netmask node1Mask -lif ip_nas_2 -home-node cvo-node
----
+
Wobei _private_ip_x_ eine ungenutzte sekundäre private IP auf e0a ist.

. Optional: Erstellen Sie ein LIF zur Speicher-VM-Verwaltung.
+
[source, cli]
----
network interface create -auto-revert true -vserver svm_2 -service-policy default-management -home-port e0a -address private_ip_y -netmask node1Mask -lif ip_svm_mgmt_2 -home-node cvo-node
----
+
Wobei _private_ip_y_ eine weitere ungenutzte sekundäre private IP auf e0a ist.

. Weisen Sie der Speicher-VM ein oder mehrere Aggregate zu.
+
[source, cli]
----
vserver add-aggregates -vserver svm_2 -aggregates aggr1,aggr2
----
+
Dieser Schritt ist erforderlich, da die neue Speicher-VM Zugriff auf mindestens ein Aggregat benötigt, bevor Sie Volumes auf der Speicher-VM erstellen können.





== Erstellen Sie eine Speicher-VM auf einem HA-Paar in einer einzelnen AZ

Mit diesen Schritten wird eine neue Speicher-VM auf einem HA-Paar in einer einzelnen AZ erstellt.  Zum Erstellen eines NAS-LIF ist eine private IP-Adresse erforderlich, und wenn Sie ein Verwaltungs-LIF erstellen möchten, ist eine weitere optionale private IP-Adresse erforderlich.

Beide LIFs werden auf Knoten 1 zugewiesen.  Die privaten IP-Adressen können bei Fehlern zwischen Knoten verschoben werden.

.Schritte
. Erstellen Sie die Speicher-VM und eine Route zur Speicher-VM.
+
[source, cli]
----
vserver create -rootvolume-security-style unix -rootvolume root_svm_2 -snapshot-policy default -vserver svm_2 -aggregate aggr1
----
+
[source, cli]
----
network route create -destination 0.0.0.0/0 -vserver svm_2 -gateway subnet_gateway
----
. Erstellen Sie ein NAS-LIF auf Knoten 1.
+
[source, cli]
----
network interface create -auto-revert true -vserver svm_2 -service-policy default-data-files -home-port e0a -address private_ip_x -netmask node1Mask -lif ip_nas_2 -home-node cvo-node1
----
+
Wobei _private_ip_x_ eine ungenutzte sekundäre private IP auf e0a von cvo-node1 ist.  Diese IP-Adresse kann im Falle einer Übernahme auf e0a von cvo-node2 verschoben werden, da die Servicerichtlinie „default-data-files“ angibt, dass IPs auf den Partnerknoten migriert werden können.

. Optional: Erstellen Sie ein LIF zur Speicher-VM-Verwaltung auf Knoten 1.
+
[source, cli]
----
network interface create -auto-revert true -vserver svm_2 -service-policy default-management -home-port e0a -address private_ip_y -netmask node1Mask -lif ip_svm_mgmt_2 -home-node cvo-node1
----
+
Wobei _private_ip_y_ eine weitere ungenutzte sekundäre private IP auf e0a ist.

. Weisen Sie der Speicher-VM ein oder mehrere Aggregate zu.
+
[source, cli]
----
vserver add-aggregates -vserver svm_2 -aggregates aggr1,aggr2
----
+
Dieser Schritt ist erforderlich, da die neue Speicher-VM Zugriff auf mindestens ein Aggregat benötigt, bevor Sie Volumes auf der Speicher-VM erstellen können.

. Wenn Sie Cloud Volumes ONTAP 9.11.1 oder höher ausführen, ändern Sie die Netzwerkdienstrichtlinien für die Speicher-VM.
+
Das Ändern der Dienste ist erforderlich, da dadurch sichergestellt wird, dass Cloud Volumes ONTAP das iSCSI-LIF für ausgehende Verwaltungsverbindungen verwenden kann.

+
[source, cli]
----
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service data-fpolicy-client
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service management-ad-client
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service management-dns-client
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service management-ldap-client
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service management-nis-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service data-fpolicy-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service management-ad-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service management-dns-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service management-ldap-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service management-nis-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service data-fpolicy-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service management-ad-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service management-dns-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service management-ldap-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service management-nis-client
----




== Erstellen Sie eine Speicher-VM auf einem HA-Paar in mehreren AZs

Mit diesen Schritten wird eine neue Speicher-VM auf einem HA-Paar in mehreren AZs erstellt.

Für ein NAS-LIF ist eine _Floating_-IP-Adresse erforderlich und für ein Management-LIF optional.  Für diese Floating-IP-Adressen müssen Sie in AWS keine privaten IPs zuweisen.  Stattdessen werden die Floating-IPs in der AWS-Routentabelle automatisch so konfiguriert, dass sie auf die ENI eines bestimmten Knotens im selben VPC verweisen.

Damit Floating IPs mit ONTAP funktionieren, muss auf jeder Speicher-VM auf jedem Knoten eine private IP-Adresse konfiguriert werden.  Dies spiegelt sich in den folgenden Schritten wider, in denen auf Knoten 1 und Knoten 2 ein iSCSI-LIF erstellt wird.

.Schritte
. Erstellen Sie die Speicher-VM und eine Route zur Speicher-VM.
+
[source, cli]
----
vserver create -rootvolume-security-style unix -rootvolume root_svm_2 -snapshot-policy default -vserver svm_2 -aggregate aggr1
----
+
[source, cli]
----
network route create -destination 0.0.0.0/0 -vserver svm_2 -gateway subnet_gateway
----
. Erstellen Sie ein NAS-LIF auf Knoten 1.
+
[source, cli]
----
network interface create -auto-revert true -vserver svm_2 -service-policy default-data-files -home-port e0a -address floating_ip -netmask node1Mask -lif ip_nas_floating_2 -home-node cvo-node1
----
+
** Die Floating-IP-Adresse muss außerhalb der CIDR-Blöcke für alle VPCs in der AWS-Region liegen, in der Sie die HA-Konfiguration bereitstellen.  192.168.209.27 ist ein Beispiel für eine Floating-IP-Adresse. link:reference-networking-aws.html#requirements-for-ha-pairs-in-multiple-azs["Erfahren Sie mehr über die Auswahl einer Floating-IP-Adresse"] .
** `-service-policy default-data-files`zeigt an, dass IPs zum Partnerknoten migriert werden können.


. Optional: Erstellen Sie ein LIF zur Speicher-VM-Verwaltung auf Knoten 1.
+
[source, cli]
----
network interface create -auto-revert true -vserver svm_2 -service-policy default-management -home-port e0a -address floating_ip -netmask node1Mask -lif ip_svm_mgmt_2 -home-node cvo-node1
----
. Erstellen Sie ein iSCSI-LIF auf Knoten 1.
+
[source, cli]
----
network interface create -vserver svm_2 -service-policy default-data-blocks -home-port e0a -address private_ip -netmask nodei1Mask -lif ip_node1_iscsi_2 -home-node cvo-node1
----
+
** Dieses iSCSI-LIF ist erforderlich, um die LIF-Migration der Floating-IPs in der Speicher-VM zu unterstützen.  Es muss kein iSCSI-LIF sein, aber es kann nicht für die Migration zwischen Knoten konfiguriert werden.
** `-service-policy default-data-block`gibt an, dass eine IP-Adresse nicht zwischen Knoten migriert.
** _private_ip_ ist eine ungenutzte sekundäre private IP-Adresse auf eth0 (e0a) von cvo_node1.


. Erstellen Sie ein iSCSI-LIF auf Knoten 2.
+
[source, cli]
----
network interface create -vserver svm_2 -service-policy default-data-blocks -home-port e0a -address private_ip -netmaskNode2Mask -lif ip_node2_iscsi_2 -home-node cvo-node2
----
+
** Dieses iSCSI-LIF ist erforderlich, um die LIF-Migration der Floating-IPs in der Speicher-VM zu unterstützen.  Es muss kein iSCSI-LIF sein, aber es kann nicht für die Migration zwischen Knoten konfiguriert werden.
** `-service-policy default-data-block`gibt an, dass eine IP-Adresse nicht zwischen Knoten migriert.
** _private_ip_ ist eine ungenutzte sekundäre private IP-Adresse auf eth0 (e0a) von cvo_node2.


. Weisen Sie der Speicher-VM ein oder mehrere Aggregate zu.
+
[source, cli]
----
vserver add-aggregates -vserver svm_2 -aggregates aggr1,aggr2
----
+
Dieser Schritt ist erforderlich, da die neue Speicher-VM Zugriff auf mindestens ein Aggregat benötigt, bevor Sie Volumes auf der Speicher-VM erstellen können.

. Wenn Sie Cloud Volumes ONTAP 9.11.1 oder höher ausführen, ändern Sie die Netzwerkdienstrichtlinien für die Speicher-VM.
+
Das Ändern der Dienste ist erforderlich, da dadurch sichergestellt wird, dass Cloud Volumes ONTAP das iSCSI-LIF für ausgehende Verwaltungsverbindungen verwenden kann.

+
[source, cli]
----
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service data-fpolicy-client
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service management-ad-client
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service management-dns-client
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service management-ldap-client
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service management-nis-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service data-fpolicy-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service management-ad-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service management-dns-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service management-ldap-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service management-nis-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service data-fpolicy-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service management-ad-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service management-dns-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service management-ldap-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service management-nis-client
----

